<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - PioneersX</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50' y='80' font-family='Arial Black,sans-serif' font-size='90' font-weight='900' text-anchor='middle' fill='%23ff1e1e'%3EX%3C/text%3E%3C/svg%3E">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>
    <div class="overlay" id="overlay" onclick="closeSidebar()"></div>
    <div class="app">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-brand"><div class="brand-logo">X</div><span class="brand-text">Pioneers<span class="x">X</span></span></div>
                <button class="sidebar-close" onclick="closeSidebar()"><i class="fas fa-times"></i></button>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-group">
                    <div class="nav-group-title">Menu</div>
                    <a href="dashboard.html" class="nav-item"><i class="fas fa-home"></i><span>Dashboard</span></a>
                    <a href="subscription.html" class="nav-item"><i class="fas fa-crown"></i><span>Subscription</span></a>
                </div>
                <div class="nav-group">
                    <div class="nav-group-title">Account</div>
                    <a href="profile.html" class="nav-item active"><i class="fas fa-user"></i><span>Profile</span></a>
                    <a href="settings.html" class="nav-item"><i class="fas fa-cog"></i><span>Settings</span></a>
                </div>
            </nav>
            <div class="sidebar-footer">
                <div class="user-menu" onclick="logout()">
                    <div class="user-avatar" id="sidebarAvatar">U</div>
                    <div class="user-details"><div class="user-name" id="sidebarName">User</div><div class="user-email" id="sidebarEmail">user@email.com</div></div>
                    <i class="fas fa-sign-out-alt user-menu-icon"></i>
                </div>
            </div>
        </aside>
        
        <main class="main">
            <header class="header">
                <div class="header-left">
                    <button class="menu-toggle" onclick="openSidebar()"><i class="fas fa-bars"></i></button>
                    <h1 class="page-title">Profile</h1>
                </div>
            </header>
            
            <div class="content">
                <div class="alert" id="alert" style="margin-bottom:24px;"></div>
                
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar">U</div>
                    <div class="profile-info">
                        <h1 id="profileName">User Name</h1>
                        <p id="profileEmail">user@example.com</p>
                        <div class="profile-badges">
                            <span class="profile-badge" id="accountType">User</span>
                            <span class="profile-badge" id="emailBadge">Not Verified</span>
                        </div>
                    </div>
                </div>
                
                <div class="profile-grid">
                    <div class="card">
                        <div class="card-header"><h2 class="card-title"><i class="fas fa-user"></i> Personal Information</h2></div>
                        <div class="card-body">
                            <form id="profileForm">
                                <div class="form-row">
                                    <div class="form-group"><label class="form-label">First Name</label><input type="text" class="form-input" id="firstName" required></div>
                                    <div class="form-group"><label class="form-label">Last Name</label><input type="text" class="form-input" id="lastName" required></div>
                                </div>
                                <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="email" disabled style="opacity:0.6;"></div>
                                <div class="form-group"><label class="form-label">Phone</label><input type="tel" class="form-input" id="phone" placeholder="+966 5xx xxx xxx"></div>
                                <div class="form-group"><label class="form-label">Company</label><input type="text" class="form-input" id="company" placeholder="Your company"></div>
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </form>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header"><h2 class="card-title"><i class="fas fa-lock"></i> Change Password</h2></div>
                        <div class="card-body">
                            <form id="passwordForm">
                                <div class="form-group"><label class="form-label">Current Password</label><input type="password" class="form-input" id="currentPassword" required></div>
                                <div class="form-group"><label class="form-label">New Password</label><input type="password" class="form-input" id="newPassword" required minlength="8"></div>
                                <div class="form-group"><label class="form-label">Confirm Password</label><input type="password" class="form-input" id="confirmPassword" required></div>
                                <button type="submit" class="btn btn-primary">Update Password</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script src="js/api.js"></script>
    <script>
        if (!API.isLoggedIn()) window.location.href = 'index.html';
        
        function loadUser() {
            const user = API.getUser();
            if (user) {
                document.getElementById('sidebarName').textContent = `${user.firstName || ''} ${user.lastName || ''}`.trim() || 'User';
                document.getElementById('sidebarEmail').textContent = user.email || '';
                document.getElementById('sidebarAvatar').textContent = (user.firstName ? user.firstName[0] : 'U').toUpperCase();
                document.getElementById('profileName').textContent = `${user.firstName || ''} ${user.lastName || ''}`.trim() || 'User';
                document.getElementById('profileEmail').textContent = user.email || '';
                document.getElementById('profileAvatar').textContent = (user.firstName ? user.firstName[0] : 'U').toUpperCase();
                document.getElementById('emailBadge').textContent = user.isEmailVerified ? 'Verified' : 'Not Verified';
                document.getElementById('emailBadge').className = 'profile-badge' + (user.isEmailVerified ? ' verified' : '');
                document.getElementById('firstName').value = user.firstName || '';
                document.getElementById('lastName').value = user.lastName || '';
                document.getElementById('email').value = user.email || '';
                document.getElementById('phone').value = user.phone || '';
                document.getElementById('company').value = user.company || '';
            }
        }
        
        function showAlert(msg, type = 'error') {
            const alert = document.getElementById('alert');
            alert.className = `alert alert-${type} show`;
            alert.innerHTML = `<i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'check-circle'}"></i> ${msg}`;
            setTimeout(() => alert.classList.remove('show'), 3000);
        }
        
        document.getElementById('profileForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.disabled = true; btn.innerHTML = '<span class="spinner"></span> Saving...';
            const result = await API.updateProfile({ firstName: document.getElementById('firstName').value, lastName: document.getElementById('lastName').value, phone: document.getElementById('phone').value, company: document.getElementById('company').value });
            if (result.success) { showAlert('Profile updated!', 'success'); loadUser(); } else { showAlert(result.message || 'Failed'); }
            btn.disabled = false; btn.innerHTML = 'Save Changes';
        });
        
        document.getElementById('passwordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (document.getElementById('newPassword').value !== document.getElementById('confirmPassword').value) { showAlert('Passwords do not match'); return; }
            const btn = e.target.querySelector('button');
            btn.disabled = true; btn.innerHTML = '<span class="spinner"></span> Updating...';
            const result = await API.changePassword({ currentPassword: document.getElementById('currentPassword').value, newPassword: document.getElementById('newPassword').value });
            if (result.success) { showAlert('Password updated!', 'success'); document.getElementById('passwordForm').reset(); } else { showAlert(result.message || 'Failed'); }
            btn.disabled = false; btn.innerHTML = 'Update Password';
        });
        
        function openSidebar() { document.getElementById('sidebar').classList.add('open'); document.getElementById('overlay').classList.add('show'); }
        function closeSidebar() { document.getElementById('sidebar').classList.remove('open'); document.getElementById('overlay').classList.remove('show'); }
        function logout() { API.logout(); window.location.href = 'index.html'; }
        
        loadUser();
    </script>
</body>
</html>
